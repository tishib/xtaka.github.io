<!-- <!DOCTYPE html> -->
<html>
  <head>
    <title>flashcard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">
    <!-- nes.css minify -->
    <link href="https://unpkg.com/nes.css@2.3.0/css/nes.min.css" rel="stylesheet" />
  </head>
  <body>
    <div style="margin: 5px;">
      <div id="setup">
        <div>
          <textarea id="prob_data" data-ans="" class="nes-textarea"></textarea>
        </div>
        <div>
          <a id="submit" class="nes-btn is-primary" href="#">Start</a>
        </div>
      </div>
      <div id="running">
        <div>
          <p>
            current score:
            <span id="cur_score">0</span>
            /
            <span id="cur_ans_num">0</span>
          </p>
        </div>
        <div class="nes-container is-rounded">
          <p id="prob">Problem Statements</p>
        </div>
        <div class="lists">
          <ul class="nes-list is-disc">
            <li id="ans1" data-ans="">Good morning.</li>
            <li id="ans2" data-ans="">Thou hast had a good night's sleep, I hope.</li>
            <li id="ans3" data-ans="">Thou hast had a good afternoon</li>
            <li id="ans4" data-ans="">Good night.</li>
          </ul>
        </div>
        <div>
          <a id="next" class="nes-btn is-success" href="#">Next</a>
          <a id="exit" class="nes-btn is-error" href="#">Exit</a>  
        </div>
      </div>
    </div>
    <script>
      const probObjList = [];
      const SETUP_ID = "setup";
      const SUBMIT_ID = "submit";
      const RUNNING_ID = "running";
      const PROB_DATA_ID = "prob_data";
      const CURRENT_SCORE_ID = "cur_score";
      const CURRENT_ANS_NUM_ID = "cur_ans_num";
      const PROB_ID = "prob";
      const ANS1_ID = "ans1";
      const ANS2_ID = "ans2";
      const ANS3_ID = "ans3";
      const ANS4_ID = "ans4";
      const NEXT_ID = "next";
      const EXIT_ID = "exit";
      const abortController = new AbortController();
      const MAX_PROB_DATA_LEN = 1024 * 100;
      const ANS_INDS = [ANS1_ID, ANS2_ID, ANS3_ID, ANS4_ID];
      let curScore = 0;
      let curAnsNum = 0;

      // utility
      function getRandInd(max) {
        return Math.floor(Math.random() * max);
      }
      function hideSetup() {
        document.getElementById(SETUP_ID).hidden = true;
      }
      function visibleSetup() {
        document.getElementById(SETUP_ID).hidden = false;
      }
      function hideRunning() {
        document.getElementById(RUNNING_ID).hidden = true;
      }
      function visibleRunning() {
        document.getElementById(RUNNING_ID).hidden = false;
      }
      function drawCurrentScore() {
        document.getElementById(CURRENT_SCORE_ID).innerText = ++curScore;
      }
      function resetCurrentScore() {
        curScore = 0;
        document.getElementById(CURRENT_SCORE_ID).innerText = curScore;
      }
      function drawCurrentAnsNum() {
        document.getElementById(CURRENT_ANS_NUM_ID).innerText = ++curAnsNum;
      }
      function resetCurrentAnsNum() {
        curAnsNum = 0;
        document.getElementById(CURRENT_ANS_NUM_ID).innerText = curAnsNum;
      }

      // setup
      function validate(rawData) {
        if (rawData.length > MAX_PROB_DATA_LEN)
          return false;
        if (rawData.length == 0)
          return false;
        return true;
      }
      function getNewLinePos(rawData) {
        if (rawData.indexOf("\r\n") > -1)
          return rawData.indexOf("\r\n");
        if (rawData.indexOf("\n") > -1)
          return rawData.indexOf("\n");
        if (rawData.indexOf("\r") > -1)
          return rawData.indexOf("\r");
        return -1;
      }
      function parse(rawData) {
        let start = rawData.indexOf('[');
        let end = getNewLinePos(rawData);
        let curData = rawData;
        while (start > -1 && end > -1) {
          let probStr = curData.substr(start, end);
          if (probStr.indexOf(']') > -1) {
            let key = probStr.substr(0, probStr.indexOf(']') + 1);
            let value = probStr.substr(probStr.indexOf(']') + 1);
            probObjList.push({key: key, value: value});
          }

          curData = curData.substr(end + 1, curData.length);
          start = curData.indexOf('[');
          end = getNewLinePos(curData);
        }
      }
      function clearProbDataForm() {
        document.getElementById(PROB_DATA_ID).value = "";
      }
      function onClickSubmit() {
        let rawData = document.getElementById(PROB_DATA_ID).value;
        if (validate(rawData)) {
          parse(rawData);
          hideSetup();
          visibleRunning();

          let inds = getProbInds();
          draw(inds);

          clearProbDataForm();
        }
      }
      function initSetup() {
        visibleSetup();
        hideRunning();

        document.getElementById(SUBMIT_ID).addEventListener("click", onClickSubmit);
      }

      // exec
      function drawProb(inds) {
        let e = document.getElementById(PROB_ID);
        let randInd = getRandInd(inds.length);
        let i = inds[randInd];
        e.innerText = probObjList[i].value;
        e.dataset.ans = probObjList[i].key;
      }
      function drawAnsList(inds) {
        for (let i = 0; i < 4; ++i) {
          let e = document.getElementById(ANS_INDS[i]);
          let prob = probObjList[inds[i]];
          e.innerText = prob.key;
          e.dataset.ans = prob.key;
        }
      }
      function draw(inds) {
        drawProb(inds);
        drawAnsList(inds);
      }
      function getProbInds() {
        let s = new Set();
        let n = probObjList.length;
        if (n < 4)
          return [];
        while (s.size < 4) {
          let randInd = getRandInd(n);
          if (!s.has(randInd))
            s.add(randInd);
        }
        return [...s];
      }
      function correct(id) {
        document.getElementById(id).style = "background: greenyellow;";
        drawCurrentScore();
      }
      function wrong(id) {
        document.getElementById(id).style = "background: orangered;";
      }
      function resetAllAnsStyle() {
        for (let i = 0; i < 4; ++i)
          document.getElementById(ANS_INDS[i]).style = "";
      }
      function onClickAns(evt) {
        let probAns = document.getElementById(PROB_ID).dataset.ans;
        if (evt.target.dataset.ans == probAns)
          correct(evt.target.id);
        else
          wrong(evt.target.id);
        drawCurrentAnsNum();
      }
      function onClickNext() {
        let inds = getProbInds();
        resetAllAnsStyle();
        draw(inds);
      }
      function initExec() {
        let e = document.getElementById(NEXT_ID);

        for (let i = 0; i < 4; ++i) {
          let e = document.getElementById(ANS_INDS[i]);
          e.addEventListener("click", onClickAns);
        }

        e.addEventListener("click", onClickNext);
      }

      // exit
      function onClickExit() {
        visibleSetup();
        hideRunning();
        cleanup();
      }
      function initExit() {
        document.getElementById(EXIT_ID).addEventListener("click", onClickExit);
      }
      function clearProbObjList() {
        probObjList.splice(0, probObjList.length);
      }
      function cleanup() {
        resetAllAnsStyle();
        resetCurrentScore();
        resetCurrentAnsNum();
        clearProbDataForm();
        clearProbObjList();
      }
      
      function main() {
        initSetup();
        initExec();
        initExit();
      }
      main();

      // compress
      const TERM_FLAG = "TERMHERE";
      let test_data1 = "[foo] bar; [fizz] buzz;"
      let test_data2 = '0000010001000110010110110110101101111011001111000110110101010011100111111001110101111011101111010101111001001011001000101001001010011110011110010000110001100110000100101011110010001001110000000111111111001010101100100000000011100100001110010111001010101000110110101000001110100010010001000000001011111011101100011001011000001110011000011011000010101101001101011010000001010100101100010111111010100000000011010100110011111011111010111010001111110010000110001001000000000100101111101101000101101111001001110100101100101010001001111000011011010011110001111100001111111101001000010011110111011111110000101010001100000010101100001111110011010110001111100011111000100111110000000110111010111010101011001111011110110101011011001001110110110011011110100111100010110000011001011111100001001001001100001110001100110000001100101110000000101101110011010010011010101111010010011111110011010111100011111001110001101010010011010110101100000000001011101100111000110110001110110111001110111111110010000010010010100100111100010011110101001111001011100011001000010000101100001001100111011111100100100100111011000000100011010000000111010100110011001100000101100011110010001110010101010010110000001000101010110110001011111111001111100111101111111001110000000110011101001011011111100100110010101101110001100111011010011000011110010111011111100000011001011101000101001110001111111111001100111001101000001000000000010011110000101100011110011100001000001110100101000100101110110101101101010101111111000110100011000100000110001010001100001101111110101100001101101000001111011110011111001100011111100010001100101111001011000111100110011010110010000110110011011001100110111010001111001011100101000110011110000001111110010100111101000101100110000100110101101011101011001011100100000100100000110001101010110001110110100010011110111100011001011101011111111010111001100001100010110010110111111101100111100010000001000011110000100010000000111000001101110001000000111101011111000010000001000110001101001110011101111010010011001101010000000101100010111110101111001100110110011000101001010110110010011111111001110011001101100000101111110000110001111101010111100010001000011101000110111010111111101010010001111101101011100001011110001110110000110110010011001000010100110110010011000010001111001101000010101001101011110111010100111111101010000001100001110111000011101111101100100011101010000110101101111111010100110110111011011000001101101101010001101111110011101010101100110001110011000101001010001010001100000111100110101100101100101110101001100010001000010100110111101001101001100000000000010100111101000010011110100100001011110101011111100101111111111100111101001000000100111111010001001111001110110100100100100000110001101110011100110011010011000100001000011011100010101110010010110111111000000100110101110101000101101101001110100000101000110110101010100001101110100101011001101100010101100101001111000110001111110010001100001011101001001101111111100110011100111100101101010010111110000000101110101011111100111000001100001010100001110100001111000110000000111111101010010111000000110001010110000100011011000111001110010011011011011001101111001110110111110111101000011000110011000001010101101010001101110110100011000101001010010000111010100101100100001001011100110110110101100010101110010001111111101011111111111000101100101010011011111100010101100000100111010000010011010011000111111011000100101001001101000111110010010011100001111001010010010111001000000100001001101000101010010110011011000011110010011010101100011111001000110011100010001010100011111110101101011111100010011010000100110011001010110101110001011110110111110101011011001000101000110101100000101111101000010100011001000001110100111000101111010110101010000001111011001001101101111101101100011101101001110111001000001001100011000110101011001001110101110001011111000100011100010101110001001101010000111110000110101011001110100001111110010010010000100110100001101100000101111111100010100110111000010011011110111010111110100100011001001001011100011110011011101011110100011010100011100100100111001111111010110101100110110000101011010110010101100111101000000000010001001010111110110011110010101111000000110010000001101101011111011110001100000000111011100100111110011010011010001001111111101011100000011000010001000111101000000111101011101111110011101000100101110010011100111010101000011001011101010101010101011100111111100000010101101001110000000011110100110101110111100110010100000110011100100101001010001111010111101100111100100100110011111010011010001011000000001000110110011000111001110001011011001110101010011010101100110001000111100000111001011010010000111000010100101101000011001101111001101010100010110001110111000101000100000110100100000011011000111010010011110100101011111100111111010011010110001001011001110110110100011111100000110110100000010010010100100011000110111101110010000100110100010110001001110111111000001100000010001000001001100111111010110000011111010110111111011000010010111110100111000010111011110001000110100001111111010110001100001110110001100101110100001101000001110100111001100011011001001001100011101111110011001111100101111100001001110111111010110000111000111111111010110101001100011100000011101010101010101010010101110001101010101010010111000011100110101001100001001111000001110001100100010111010100010100010010010011000111000100010011001110001111000111001000010101111010011010101001000100010101100011111111000111111111111101010011011010000000011010111001001000101010011100000111010111110101010111110011101001101010110000000100110110011110001110101101111110010000101010000010111011010010011011010000011001101000100000110100110010010100011010000100001100101111111000100010010111111000001010110110000001000111110111000011010111001100101100101111101010100111000111000110100011011000111001111010001000000111011110100011011110111111101000100101010001101110001111001100000001010111000110000011110110010000011001110000000100010010001000000000000010110010010100000001000010101011011110100101100101101100011100110101110010001010010010000110010000111010110000100000100100000111010100011101101001110001111011100101110001101011111111000011000000111111110000010110001011001100010011111010100101101100001001011110011101000111110000011111011011101110001100010101011001111110001101101010011100101101001111110111010001000101000100010110001011011011011010110011100010111001110110010110111011101100110100011111100101000101100010010101110011111001011001101101000100110100100111111000011100110010101001110000101001010111000010111110010010101101101000111101110000010110001100010010111111001111010010001010010101100110100001111011001010001110110111101010001110011110010001110101011101010100010101101011101011100001001000110011111010010101110001100100011111011111011110101111100000000111110101011011000010111000010101111100110111111001011001101101000010101101110101001000111110011111100010010000101000100101010010011000101000011011100110110000011010011110111111110001101011101001000011110100111010011101111101011001101100101110000010010110000110001101110011011011001010110010011010101010100111011010100001110110100110010010101001001110111011111101001110101100110001100010001100001110101110100001001101111011111010110001000100010001100001000111011111110011101000101011011010000111101101100011110111101100101101010001010001100111000011100000111110001000111000111000111101001101110110101100001011111011100100110011101101100110111010000111110011010101000011101010110111110101001111011001011100111110011110110101101001001101101111100111100011010100011000001101100010101101001011101001011001101000101001011101101111010111100111000111110101110011100100111101101011100101001101100101010010100111011011010010000000011000100001000100001101101110011110110111111011111011001100000010001000101100100110110100101100000001100101100001111101001011111010011010101111011010100011000111000001101110101110101111101000010101110101111010001010010110000110010110011011100101000010111001111000000001010110100010001011001000101110001001000101011000001001011111000011010111111011100101010101011100001001010010011000001011010111111011010100101110010000000001111110001001111100101011010111010110011100000110110111110000111001101010010001010100011010101101100100101101110011111010101111000011000110010111101110110100001001001111101000010110101010110000111010010100101101110100111100110001001100110111011011110100000111101110001010101001010111011110100010001011100101100100111111101011100100001101110110000101101100101100010111011100011001010000100010010100110111000011111001011000111001101111011101111101100110010001010011011001010101111000101010010111100000111000011001000011010110111111110110000010010000010011010100111001101000111001011001011010001000001110101011000010000111010101111100111010101111110111010000011111101111110000001100100011110011101110000101010110110101101001000000101100001011100011110000110010011001100000101111111010001100111111111110111111000010001000101010011101110101011000001111111111000001100001001110011111001000111000000011011111101111110001111110000100001111011001011010001100111100001111000111111010000011111000000001101101100101100100000010111101111011100011110011100011101000010011010110001101110100100111011110011001100110100111111010111010001111111100100001111110101010110001010000000101111100110110111111101110100000101010001110001000101110100010001000000100101010011110011001100100011000011111000011101001010000100100110100111100110010000010101100101010011010111011110110110011000100111001111110010100000101000101111011110100110110001011010010001111110011000100000000100010011111101010100111100000001100100101111101100000010001000000110110100110101001011101000001011011000001000011011110001101010111101000001100110000110000101000101011110111100100001010011011010100111010101011011101000001001101100110000100111110111101010110000110101001010100110000111000001010001000110101110111000011011101001000101100010000001110000010110101011001000110011110001101111000011000110010000101010101011010111110101111100010101001010111101110001100010001010110011010011001101010100100111101000000111000111111010110111011110001001101101001101100000110011111110011001100100111001011011100011011001110011010010111011011101100011101100101011000011101101010001010000101000001000010001001110010101101101010011010000001110000100001100001010111011110100100100010010000001010001110101100111010101111011110011001111110011111000011001100111010101001000011100001111101010111111011000110100000110100101000100101000101010100001100010000001001110011010010010000101101110101000110111010110101011101000010100100011100100000000111111111111100100011110010100110010111110011001001111011110111101010101010001100011011101101111000001000110101000000110101001111101110110010000110101011000000000110111001101100101111110101111010011011010000000001001010111110110110010100011101110110000000001101101010100110010110000101111110000110011101100001110111001000011110111101001010011111110111000000010101011000101100101100101100100001110001101001010111100011010011001001010110011111100000000001000101100111011100110010100010101110010100100000001111100110101010101101110101010110110010001010010011100100000011000011000101000110000110001000111011110000001001111000001010011010011110101110010111000101000110111000101011110100001001110100011100111000011010101000001110100101001011101011001101110101100010000001010100011001011100001100111100010011101100010010100100000011111101101001010001011001001111001110111011001000100001100100101100000010101001011110100011100010101101010110010001000100101111011001010100011101101100100010101010111100011010111111111101011100000111001100111110011011000010001101001101010010111010110011100111011110100000010101010001111101010011001011111001111000111110101011001000110001100110101010111110100100110000000000110001111001101011010000010010100010111001011010100000101000100011110100011000100001110101001111100101110010010011111010001011000011111110101011000100000100000111001101111001101101011010011101110111110100111111111101010011000001001110010111110100111100011011111111101010000110100000100101100011111101000110111110100011100001110000111101000010001000100011110010101001000010101000111011110000101011001000100010001011010110110111011010100100110111011111000001101110100001101010101111011111000110001011100111010111100110001010001000011101010001100101001110011110101100110111110000001111001011000000100010001110000111101000110010110010110011100110100000011110100111100101110011111010111000000111100011001101100001000011010001011110111000000010011111101000111101001000100110000100001011001110100011100001001111100000001111100111111001111110111000110100100111110101111110110011100100010010101001101111101101100001011101101111111111000101101000101000110011000010010011110001111100101110100100001100000101000001010001010010011001001100101010100100111010001001110100010111101100100111001100101101100001110101001110101101001110000101111001110001100010010111100110111001011011010000100001100111110010010001111110110100111111101101000101100111110110001101010011011001101101010001010111111010100111001011001100010111110011100101011011111111111111010010000011011001010101110101011010100000000011100001000100111010010001111101001010101010011101001010111110100101001110110111100110100101100110011010001111011101111100101110110010101110010100101010011111101111000101011110111111010000001110100110100000011010100010010000111010010011010110010011100100001000100011111101010001110011110001100100011001000000100110010100110111001010001001011100010100110101111000011101100101010001101011101111100000110111101010101010010111100100000001011111010010100011010101111000011101001010110010000111000011110111000110001111111101011010101100111011111111111010010111100110101111101100001011100101011111000001100001100011111111100100100010111100110010110011001111001011010011111000111110000101110000110100100011010101000110000100110000011110110010101100001010111100010110111011011001101101010100111011110101010110000000111101101011010000001001011001010110000011100011111111101100110110010011111010000001011101101100111010110011100000001001100011111010011001001000100110000011110011001100010010100101100011110101101010001010001100110111001000111110100010010001101010001100000100010100000110110101011100100100011010011001110011101100011001110110110110110101111011111001100010001010010110011101010001110000111011010001000000001010011011010001111100001001000011110011100010111011010001010101000111000101111101111001111110000000001110001111111110000101000110011010010010110100111100111000101100001010001111111101110001010011101010000001010101000100101000011110010101110001011001101100010110011110001010001111001010010101110101110000101000011011000100111010011101010101000010110001001000011011100000101011111110010000111000111001101010000010110011100011001100110000111011010111101110100010101011001111000011111011110011101101011010011111001011011011010100100111000000011111011000010101110001001000010000110010010101100110100011101001111011110011000110101010011111011111101001010100101101000101010110110001110011101001110010111000011010110110111111010000111001110011010000011101100010010100110101110100011101000011101000011100110001111010011100010101111111101111001110000010100010100011100111010010110111110110001110111011010000111000000101110001111100011110001011001100001100100100000110011001010101100110100101010011111111011011101110101111000001001001100100011100010011010111111001111010001101000100100001001010111110100100111101011101011100110111001110101011111000110101110011011001101000001000001000010110100001111010110011110110001000011000001000110110101010000101011010010110110111010111010011111100111110001011101011110000001010001010101001110111101010011111000111101011011000011101000111000000010011101110110110110100010110010111100010011110010001000111000011011011011000000111111001100101101111001110001010101101000001101110011111100100011000011100101101110100101101110110111110100101110011010110110000110001101001101010010111100100011101100100101101111000100110001000111000110010101100111011110011100101';
      let test_data3 = '91488133976917667819658455435281919646112100916091005752241797211234398431725509744056408229932180646135744723882255823321455775914516627893233551342731393275672848567887831036767936174157442392856674325996336223858994652173366363582046609847117756974833995644157464231155347104133526598317103532057243539368126805717614666531026957643592292794156735675671935089817768459714548710151001691278591183218925126515354960573622752181478748347530757314177617761147572563978764391323411003916329110013522291307971764249952483373276471829384614827222614947541360807951002516586882216513589156843659464010985961369416112277455545592553676316245833754942859361476572071675386697979219163727672627354483382837730712787793224855016169442212957349665818121743418378984377148515391782490349510079434873325980611242709225134170469848269774186232253189382792888687497172422727759940204143334961117776895123573893846420105111697518248713789057555980292885186710737595981517698765213997232843367837568977456744836269145291677270277028164822667739143445625647763196690414110029078295097389100355397516561648257818541615163154352126581634878015190968932309275455556142920733917145175244378996154528325013189472418248443425292425031701354277569622646339961898754537534737809172169523908337978379632593553757286587934430737310060313433841003980629741389832774280133218515161782874641734193910090377969233290121293557653773837304532287980417081547993711626930496589752285879429282521136713012131923297627693336714671322253876650774952204660734840828029969266616497485806971924630329874563074934468378719284356550323952624353981123088843053624620324642662866523869164745813382948906849398331880139524039399049714437118923956222158091333080733750329780586895529298447487399848410592374135594777667775087467399447748232124167141536286788423866992213543086344755351424781519349989253992850459510728881358251104494917593598842785647217100463339757685295193';

      function create_rules(str) {
        let res = new Map();
        let i = 0;
        for (let j = 0; j < str.length; ++j) {
          let c = str[j];
          if (!res.has(c)) {
            res.set(c, i);
            i++;
          }
        }
        return res;
      }
      function create_vars(str, rules) {
        let i = 0;
        let res = "";
        for (let j = 0; j < str.length; ++j) {
          let c = str[j];
          if (!rules.has(c)) {
            rules.set(c, i);
            i++;
          }
          res += res == "" ? rules.get(c) : ' ' + rules.get(c);
        }
        return res;
      }
      function count_br_freqs(vars) {
        let res = new Map();
        let strs = vars.split(' ');
        for (let i = 1; i < strs.length; ++i) {
          let bigram = strs[i - 1] + ' ' + strs[i];
          let cnt = res.get(bigram) ? res.get(bigram) : 0;
          res.set(bigram, cnt + 1);
        }
        return res;
      }
      function find_freq_br(cnts_m, rules) {
        // find most frequency bigram
        let cur_freq = 1;
        let res = "";
        cnts_m.forEach((value, key) => {
          if (value > cur_freq) {
            cur_freq = value;
            res = key;
          }
        });
        if (cur_freq == 1)
          return "";
        return res;
      }
      function replace_start_bigram(vars, freq_br, next_var) {
        let res = vars;
        let target = freq_br + ' ';
        let offset = target.length;
        if (vars.substring(0, offset) == target)
          res = vars.replace(target, next_var + ' ');
        return res;
      }
      function replace_end_bigram(vars, freq_br, next_var) {
        let res = vars;
        let target = ' ' + freq_br;
        let offset = vars.length - target.length;
        if (vars.substring(offset, vars.length) == target)
          res = vars.replace(target, ' ' + next_var);
        return res;
      }
      // 出現頻度の最も高いBigramを新しい変数に変換して、変数のリストに追加する
      function paring(vars, freq_br, next_var) {
        let res = vars;

        res = replace_start_bigram(res, freq_br, next_var);
        res = res.replaceAll(' ' + freq_br + ' ', ' ' + next_var + ' ');
        res = replace_end_bigram(res, freq_br, next_var);
        
        return res;
      }
      function do_comp(vars, rules) {
        const limit = 10000;
        let i = 0;
        let cur_freq = "";

        do {
          let cnts_m;
          let next_var;
          
          cnts_m = count_br_freqs(vars);
          cur_freq = find_freq_br(cnts_m, rules);
          if (!cur_freq)
            break;

          next_var = rules.size;
          rules.set(cur_freq, next_var);
          vars = paring(vars, cur_freq, next_var);
        } while (i++ < limit || !cur_freq);

        return [vars, rules];
      }
      function compress(data) {
        let rules;
        let vars;
        
        // init
        rules = create_rules(data);
        vars = create_vars(data, rules);

        // set termination flag
        rules.set(TERM_FLAG, -1);

        // compress
        [vars, rules] = do_comp(vars, rules);

        // finalize
        let next_var = rules.size;
        rules.set(vars, next_var);
        vars = next_var;
        return [vars, rules];
      }
      // decompress
      function decompress(data, rules) {
        let rev = new Map([...rules].reverse());
        let res = data;
        let is_term = false;
        rev.forEach((value, key) => {
          if (key == TERM_FLAG)
            is_term = true;
          if (!is_term) {
            res = (res + "").replaceAll(value, key);
          } else {
            res = (res + "").replaceAll(' ' + value, key);
            if (value == 0)
              res = (res + "").replace(value, key);
          }
        });
        return res;
      }
      // let [vars, rules] = compress(test_data1);
      // let decomp_data = decompress(vars, rules);
      // if(test_data1 == decomp_data)
      //   console.log("success!");

    </script>
  </body>
</html>